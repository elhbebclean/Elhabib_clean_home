<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تم التحويل إلى واتساب - شركة الحبيب لتنظيف المنازل</title>
<meta name="description" content="شكراً لتواصلك معنا. جارٍ تحويلك إلى واتساب.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<link rel="canonical" href="https://elhbebclean.github.io/Elhabib_clean_home/thankyou-whatsapp.html">

<script>window.dataLayer = window.dataLayer || [];</script>

<!-- eligibility check: src / referrer / sessionStorage -->
<script>
(function(){
  function getParam(n){ try{ return (new URL(window.location.href)).searchParams.get(n);}catch(e){return null;} }
  var srcOk = getParam('src') === 'whatsapp';
  var refOk = false;
  try{
    if(document.referrer){
      var r = new URL(document.referrer);
      refOk = (r.hostname === location.hostname) && (/index\.html$|\/Elhabib_clean_home\/?$/.test(r.pathname));
    }
  }catch(e){refOk=false;}
  var ssOk = false;
  try{ ssOk = sessionStorage.getItem('from_whatsapp_btn') === '1'; }catch(e){}
  window.__eligible_for_conversion = !!(srcOk || refOk || ssOk);
})();
</script>

<style>
body{font-family:Arial, sans-serif; text-align:center; padding:40px; background:#f9f9f9}
h1{color:#25D366;font-size:28px} p{font-size:18px}
a.button{display:inline-block;margin-top:20px;padding:12px 20px;background:#25D366;color:#fff;text-decoration:none;border-radius:8px}
a.map-link{display:inline-block;margin-top:25px;font-size:18px;color:#007bff;text-decoration:underline}
</style>
</head>
<body>
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLM4RMFM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<h1>✅ شكراً لتواصلك معنا عبر واتساب!</h1>
<p>سيتم تحويلك الآن لمحادثة مباشرة على واتساب مع فريق الحبيب كلين.</p>
<a href="https://wa.me/201016961497" class="button" target="_blank">اضغط هنا إذا لم يتم التحويل</a>

<h2 style="margin-top:40px;">📍 موقعنا على Google Maps</h2>
<a href="https://maps.app.goo.gl/wkatbwKjdm4J5vp48" target="_blank" class="map-link">افتح موقعنا على Google Maps</a>

<script>
(async function(){
  // لا نرسل أي شيء إذا لم يكن الوصول مؤهلًا (من زر أو من الصفحة الرئيسية)
  if(!window.__eligible_for_conversion){
    console.warn('Visit not eligible for conversion (whatsapp).');
    return;
  }

  // Optional: capture gclid (from URL or cookie)
  function getParam(n){ try{ return (new URL(window.location.href)).searchParams.get(n); }catch(e){return null;} }
  var gclid = getParam('gclid') || (document.cookie.match(/(^| )gclid=([^;]+)/) ? document.cookie.match(/(^| )gclid=([^;]+)/)[2] : null);
  if(getParam('gclid')) document.cookie = "gclid="+getParam('gclid')+"; path=/; max-age="+60*60*24*90;

  // Prepare enhanced conversions: hash phone and push user_data
  var phone = '201016961497'; // نفس رقمك (أو اجلب من query/session إذا عندك)
  async function sha256Hex(s){
    const enc = new TextEncoder().encode(String(s));
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }
  try{
    const phoneHash = await sha256Hex(phone);
    window.dataLayer.push({
      'event': 'enhanced_conv_ready',
      'user_data': { 'phone_number': phoneHash, ...(gclid?{gclid:gclid}:{}) }
    });
  }catch(e){ console.warn('Enhanced conv hash failed', e); }

  // أخيراً: أرسل حدث الـ Custom Event الذي يلتقطه Trigger في GTM
  // الاسم يجب يطابق اللي عاملها في GTM: "whatsapp_conversion_fired"
  window.dataLayer.push({'event':'whatsapp_conversion_fired', 'send_to':'AW-16529004339/G1k-CLeXxsMaELOu0sk9'});

  // ثم نوجه المستخدم (fallback) بعد تأخير طفيف
  setTimeout(function(){ window.location.href = 'https://wa.me/201016961497'; }, 2500);
})();
</script>
</body>
</html>
