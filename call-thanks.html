<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تم التحويل للاتصال - شركة الحبيب لتنظيف المنازل</title>
  <meta name="description" content="شكراً لتواصلك معنا في شركة الحبيب لتنظيف المنازل. جاري تحويلك إلى الاتصال المباشر بخدمة العملاء.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <link rel="canonical" href="https://elhbebclean.github.io/Elhabib_clean_home/call-thanks.html">

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KLM4RMFM');
  </script>
  <!-- End Google Tag Manager -->

  <!-- Google Ads Conversion Tracking -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16529004339"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-16529004339');
  </script>

  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; background-color: #f9f9f9; }
    h1 { color: #28a745; font-size: 28px; }
    p { font-size: 18px; margin-bottom: 20px; }
    a.map-link { display: inline-block; margin-top: 25px; font-size: 18px; color: #007bff; text-decoration: underline; }
    a.call-now { display: inline-block; margin-top: 30px; font-size: 18px; color: white; background: #28a745; padding: 12px 25px; border-radius: 6px; text-decoration: none; }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLM4RMFM"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <h1>✅ شكراً لتواصلك معنا!</h1>
  <p>سيتم تحويلك الآن لاتصال مباشر بخدمة العملاء خلال ثوانٍ قليلة.</p>

  <!-- زر احتياطي في حال لم يعمل التحويل التلقائي -->
  <a href="tel:01016961497" class="call-now">📞 اضغط للاتصال الآن</a>

  <h2 style="margin-top: 40px;">📍 موقعنا على Google Maps</h2>
  <a href="https://maps.app.goo.gl/wkatbwKjdm4J5vp48" target="_blank" class="map-link">
    اضغط هنا لفتح موقعنا على Google Maps مباشرة
  </a>

  <script>
    // تنظيف الرقم ثم SHA-256
    async function sha256Digits(message) {
      const digitsOnly = String(message).replace(/\D+/g, '');
      const msgBuffer = new TextEncoder().encode(digitsOnly.trim().toLowerCase());
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function getParam(name) {
      try {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
      } catch (e) {
        return null;
      }
    }
    function getGclid() {
      const fromParam = getParam('gclid');
      if (fromParam) {
        document.cookie = "gclid=" + fromParam + "; path=/; max-age=" + 60*60*24*90;
        return fromParam;
      } else {
        const match = document.cookie.match(new RegExp('(^| )gclid=([^;]+)'));
        return match ? match[2] : null;
      }
    }
    const gclid = getGclid();

    async function sendConversionAndCall() {
      try {
        const phoneForHash = '201016961497';
        const phoneHash = await sha256Digits(phoneForHash);

        const conversionLabel = 'OIQ7COaD0ewaELOu0sk9'; // Label الخاص بالتحويل (موجود عندك)
        const sendTo = 'AW-16529004339/' + conversionLabel;
        const redirectTel = "tel:01016961497";

        // Fallback redirect in case callback never fires (6s)
        const fallbackTimeout = 6000;
        let redirected = false;
        const doRedirect = () => {
          if (!redirected) {
            redirected = true;
            window.location.href = redirectTel;
          }
        };

        // Set fallback
        const fbTimer = setTimeout(doRedirect, fallbackTimeout);

        // Send conversion with event_callback
        gtag('event', 'conversion', {
          'send_to': sendTo,
          'value': 100.00,
          'currency': 'EGP',
          'user_data': {
            'phone_number': phoneHash,
            'gclid': gclid
          },
          'event_callback': function() {
            clearTimeout(fbTimer);
            doRedirect();
          }
        });

      } catch (err) {
        console.warn('conversion send failed', err);
        // لو حصل خطأ نروح للاتصال فورًا
        window.location.href = "tel:01016961497";
      }
    }

    // نفّذ الإرسال ثم الاتصال
    sendConversionAndCall();
  </script>
</body>
</html>
